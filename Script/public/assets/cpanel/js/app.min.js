"use strict";const App={name:"Cloud Monster PHP Application",version:"1.0",author:"John Antonio",isInit:!1,page:null,init:function(){this.isInit||(this.isInit=!0,this.router.parent=this,this.router.route(),this.sayHello())},router:{url:null,action:null,parent:null,route:function(){let e=this;e.url=window.location.href,e.parent.services.search.init();let t=e.url.replace(ROOT+"/cpanel/",""),i=(t=(t=t.split("?")[0]).split("#")[0]).split("/");if(i.length>0&&(e.action=i.shift(),method_exists(e,e.action)))return e[e.action].apply(e,i)},files:function(){this.parent.services.files.init()},analytics:function(){this.parent.services.analytics.init()},dashboard:function(){this.parent.services.analytics.init(),this.parent.services.storage.init()},process:function(){this.parent.services.process.init()},buckets:function(e=""){switch(e){case"list":let t=this.parent.services.bucketList.init();this.parent.services.folderList.init([t,"move"],"Move To",!1);break;case"new":Dropzone.autoDiscover=!1;let i=this.parent.services.upload.init();this.parent.services.folderList.init([i,"setSelectedFolder"],"Upload To");break;case"view":if($("#bucket").length>0){this.parent.services.tracker.init().run();let e=this.parent.services.upload;e.isReUpload=!0,e.init(),this.parent.services.bucketView.init()}}},drives:function(e=""){switch(e){case"new":case"edit":this.parent.services.drives.drive.init();break;case"list":this.parent.services.drives.list.init()}}},services:{files:{init:function(){$("#files-list").DataTable(),this.bind("#select-drives-list","driveSelected","change")},driveSelected:function(){let e=this.activeNode.val();insertParam("drive",e)},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t](e)}))}},storage:{activeNode:null,init:function(){this.bind(".clear","clear")},clear:function(){let e=this,t=e.activeNode.attr("data-type");$.ajax({url:ROOT+"/cpanel/storage/clear/"+t,type:"GET",contentType:"application/json",dataType:"json",success:function(t){t.success?e.activeNode.text("cleared"):alert("Something went wrong")},error:function(e,t){alert("error occurred")},complete:function(){}})},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t](e)}))}},process:{activeNode:null,init:function(){this.update()},update:function(){let e=ROOT+"/cpanel/process/data",t=this;$.getJSON(e,function(e){t.appendData(e),setTimeout(function(){t.update()},1e3)})},appendData:function(e){if("threads"in e){let t=e.threads,i=$("#threads-tbl"),a=this.getActiveThreads(),n=new Array;$(".active-threads").text(t.active),$(".total-thread-memory-usage").text(t.memoryUsage),Object.keys(t.data).forEach(function(e){let s=t.data[e];n.push(s.pid);let o="<td >#"+s.pid+'</td><td className="text-muted">'+s.memoryUsage+'</td><td className="text-muted">'+s.creationDate+'</td><td className="text-muted">'+s.runTime+"</td>";if(a.includes(s.pid)){let e="#"+s.pid;i.find(e).html(o)}else i.append('<tr id="'+s.pid+'"> '+o+"</tr>")});let s=a.filter(function(e){return-1==n.indexOf(e)});s.length>0&&s.forEach(function(e,t){$("#"+e).remove()})}"upload"in e&&$(".total-upload-process").text(e.upload.processing)},getActiveThreads:function(){var e=new Array;return $("#threads-tbl tbody tr").each(function(){e.push($(this).attr("id"))}),e},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t](e)}))}},analytics:{activeNode:null,fileId:0,init:function(){this.visitsByMonthly.init(),this.liveVisitors.init(),this.visitorsMap.init()},visitorsMap:{name:"visitorsByCountry",activeNode:null,dateRangePicker:null,startDate:"",endDate:"",isUnique:!1,map:null,data:{},fileId:0,init:function(){let e=this,t=$("#visitors-map");1===t.length&&(e.map=t,e.loadFileId(),e.dateRangePicker=$("#visitsByCountry"),e.bindDataRangePicker(),e.bind("#visitors-map","showLabel","labelShow.jqvmap"),e.bind("#mapVisitsType","visitsTypeSelected","change"),e.updateMap())},showLabel:function(e,t,i){this.data[i]>0&&t.append(": <strong>"+this.data[i]+"</strong>")},visitsTypeSelected:function(){let e=this.activeNode.val();this.isUnique="unique"===e,this.updateMap()},updateMap:function(){let e=this,t=$(".jqvmap-region");$.ajax({url:ROOT+"/cpanel/analytics/json",type:"GET",contentType:"application/json",dataType:"json",data:{chart:e.name,d1:e.startDate,d2:e.endDate,unique:e.isUnique,file:e.fileId},beforeSend:function(){e.load()},success:function(i){setTimeout(function(){e.data=i,t.attr("fill","#78828c1a"),t.attr("original","#78828c1a"),e.map.vectorMap("set","values",e.data)},700)},error:function(e,t){alert("Map data loading failed")},complete:function(){setTimeout(function(){e.load()},700)}})},loadFileId:function(){let e=$("#selected-file");1===e.length&&(this.fileId=e.attr("data-id"))},bindDataRangePicker:function(){let e=this;e.dateRangePicker.daterangepicker({showDropdowns:!0,opens:"left",startDate:"1/12/2021",minDate:"1/1/2021",maxDate:moment().format("D/M/YYYY"),autoUpdateInput:!0,locale:{format:"D/M/YYYY"},ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},cancelClass:"btn-secondary"}),e.dateRangePicker.on("apply.daterangepicker",function(t,i){e.filtered(i)})},filtered:function(e){this.startDate=e.startDate.format("DD-MM-YYYY"),this.endDate=e.endDate.format("DD-MM-YYYY"),this.updateMap()},load:function(){let e=this.map.closest(".card");e.length>0&&e.toggleClass("card-loading")},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t].apply(a,arguments)}))}},liveVisitors:{name:"liveVisitors",activeNode:null,chart:null,data:[],init:function(){let e=this;"undefined"!=typeof VisitorsLive_BarChart&&(e.chart=VisitorsLive_BarChart,e.updateChart())},updateChart:function(){let e=this;$.ajax({url:ROOT+"/cpanel/analytics/json",type:"GET",contentType:"application/json",dataType:"json",data:{chart:e.name},success:function(t){let i=t.visits,a=new Date;e.data.push({x:a,y:i}),e.data.length>15&&e.data.shift(),e.chart.updateSeries([{name:"visits",data:e.data}]),$(".num-of-live-visits").text(i),setTimeout(function(){e.updateChart()},1e3)},error:function(e,t){alert("Live Visits chart data loading failed")},complete:function(){setTimeout(function(){e.noData()},900)}})},loading:function(){this.chart.updateSeries([]),this.chart.updateOptions({noData:{text:"loading..."}})},noData:function(){this.chart.updateOptions({noData:{text:"no data"}})},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t](e)}))}},visitsByMonthly:{name:"visitorsByMonthly",activeNode:null,dateRangePicker:null,month:0,year:0,chart:null,fileId:0,init:function(){let e=this;"undefined"!=typeof VisitorsByMonthly_BarChart&&(e.chart=VisitorsByMonthly_BarChart,e.dateRangePicker=$("#visitsMonthlyDatePicker"),e.bindDataRangePicker(),e.loadFileId(),e.updateChart())},loadFileId:function(){let e=$("#selected-file");1===e.length&&(this.fileId=e.attr("data-id"))},bindDataRangePicker:function(){let e=this;e.dateRangePicker.daterangepicker({singleDatePicker:!0,showDropdowns:!0,minDate:"1/2021",maxDate:moment().format("M/YYYY"),autoUpdateInput:!0,locale:{format:"M/YYYY"},cancelClass:"btn-secondary"}),e.dateRangePicker.on("show.daterangepicker",function(e,t){t.container.find(".calendar-table").addClass("my-only")}),e.dateRangePicker.on("hide.daterangepicker",function(e,t){t.container.find(".calendar-table").removeClass("my-only")}),e.dateRangePicker.on("apply.daterangepicker",function(t,i){e.filtered(i)})},updateChart:function(){let e=this;$.ajax({url:ROOT+"/cpanel/analytics/json",type:"GET",contentType:"application/json",dataType:"json",data:{chart:e.name,month:e.month,year:e.year,file:e.fileId},success:function(t){let i=t,a=[],n=[];$.isEmptyObject(i)||Object.keys(i).forEach(function(e){let t=i[e];a.push({x:t.date,y:t.visits}),n.push({x:t.date,y:t.uniqVisits})}),setTimeout(function(){e.chart.updateSeries([{name:"total visits",data:a},{name:"unique visits",data:n}])},900)},error:function(e,t){alert("Visits chart data loading failed")},complete:function(){setTimeout(function(){e.noData()},900)}})},loading:function(){this.chart.updateSeries([]),this.chart.updateOptions({noData:{text:"loading..."}})},noData:function(){this.chart.updateOptions({noData:{text:"no data"}})},filtered:function(e){this.month=parseInt(e.container.find(".monthselect").val())+1,this.year=parseInt(e.container.find(".yearselect").val()),e.setStartDate(this.month+"/"+this.year),this.loading(),this.updateChart()},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t](e)}))}},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t](e)}))}},drives:{activeNode:null,list:{activeNode:null,activeModal:null,item:{id:0,name:""},init:function(){this.bind(".view-more-info","viewMoreInfo"),this.bind(".delete-drive","delete"),$("#cloud-drive-list-tbl").DataTable()},viewMoreInfo:function(){this.loadModal("drive-more-info-modal");let e=this.activeModal.find(".cm-loader"),t=this.activeModal.find(".data-json");cleanAlerts("drive-more-info-alert-wrap"),$.ajax({url:ROOT+"/cpanel/drives/more-info/"+this.item.id,type:"POST",data:{},beforeSend:function(){e.show(),t.hide()},success:function(e){if(e.success){let i=e.data;if("accInfo"in i){let e=i.accInfo;if($.isEmptyObject(e))addAlert("Data not found","warning","drive-more-info-alert-wrap");else{let i=JSON.stringify(e,null,2);t.text(i),t.show()}}}},error:function(e,t){},complete:function(){e.hide()}}),this.modal("show")},delete:function(){let e=this;e.loadModal("del-drive-modal");let t=new Button(e.activeNode);e.activeNode.hasAttr("data-confirm")?e.modal("show"):(t.loading(),redirect("/drives/delete/"+e.item.id))},loadItem:function(e){this.activeNode=e;let t=e.closest("tr");t.length>0&&(this.item.id=t.attr("id"),this.item.name=t.find(".name").text())},loadModal:function(e){let t="#"+e;this.activeModal=$(t)},modal:function(e){this.activeModal.modal(e)},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.loadItem($(this)),a[t](e)}))}},drive:{activeNode:null,isEdit:!1,source:null,id:0,init:function(){this.bind("#select-drives-list","driveSelected","change");let e=$("#new-drive-form");this.isEdit=e.attr("data-is-edit"),this.id=e.attr("data-id"),this.check()},check:function(){this.isEdit&&(this.isActive()||addAlert("Cloud drive authentication failed","danger"))},isActive:function(){let e=!1;return this.loadFormData(),$.ajax({url:ROOT+"/cpanel/drives/check/"+this.id,type:"GET",async:!1,success:function(t){t.success&&(e=!0)}}),e},driveSelected:function(){let e=this.activeNode.val();isEmpty(e)||redirect("/drives/new?source="+e)},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t](e)}))}}},folderList:{node:null,activeNode:null,breadcrumb:null,callback:null,alertWrap:"select-folder-alert-wrap",list:{node:null,init:function(e){this.node=e.find(".folder-list")},add:function(e){this.node.append(e)},clean:function(){this.node.html("")},loading:function(){},loaded:function(){}},item:{id:0,name:"",node:null,default:null},autoClose:!0,location:"",init:function(e=null,t="",i=!0){this.node=$("#select-folder-modal"),""!==t&&this.node.find(".modal-title").text(t);this.bind(".open-folder","open"),this.bind("#select-folder","selected"),this.callback=e,this.autoClose=i,this.list.init(this.node),this.setBreadcrumb(),this.setDefaultItem(),this.load()},open:function(){this.list.node.removeClass("active"),this.load()},close:function(){this.node.modal("hide")},selected:function(){if(null!==this.callback){let e=this.callback;"string"==typeof e?window[this.callback](this.item.id,this.item.name,this.location,this):2===e.length&&this.callback[0][this.callback[1]](this.item.id,this.item.name,this.location,this),this.autoClose&&this.close()}},load:function(){let e=this;$.ajax({url:ROOT+"/cpanel/folders/list/"+e.item.id,type:"POST",data:{},beforeSend:function(){},success:function(t){t.success&&e.appendData(t.data)},error:function(e,t){},complete:function(){}})},appendData:function(e){let t=this;if(this.location="","folders"in e){let i=e.folders;i.length>0?(this.list.clean(),i.forEach(function(e,i){let a=t.item.default.clone();a.attr("id",e.id),a.find(".folder-name").text(e.name),t.list.add(a)})):null!==this.item.node&&(this.list.node.find(".open-folder").removeClass("active"),this.item.node.addClass("active"))}if("parentList"in e){let i=e.parentList,a=t.breadcrumb.clone();i.length>0&&i.forEach(function(e,i){let n='<li class="breadcrumb-item open-folder" id="'+e.id+'" ><a href="javascript:void(0)">'+e.name+"</a></li>";t.location+="/"+e.name,a.append(n)}),t.node.find("#breadcrumb").html(a),t.location="/home"+t.location}},reset:function(){this.item.id=0,this.item.name=""},setDefaultItem:function(){this.item.default=$($.parseHTML('<div id="" class="list-item open-folder px-3" ><svg class="icon tb-icon text-warning align-middle px-0" width="1em" height="1em" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" d="M11.828 5h3.982a2 2 0 011.992 2.181l-.637 7A2 2 0 0115.174 16H4.826a2 2 0 01-1.991-1.819l-.637-7a1.99 1.99 0 01.342-1.31L2.5 5a2 2 0 012-2h3.672a2 2 0 011.414.586l.828.828A2 2 0 0011.828 5zm-8.322.12C3.72 5.042 3.95 5 4.19 5h5.396l-.707-.707A1 1 0 008.172 4H4.5a1 1 0 00-1 .981l.006.139z" clip-rule="evenodd"></path>\n</svg><span class="folder-name"></span></div>'))},setBreadcrumb:function(){this.breadcrumb=$($.parseHTML('<ol class="breadcrumb breadcrumb-arrows px-3 py-2"  aria-label="breadcrumbs"><li class="breadcrumb-item open-folder" id="1"><a href="javascript:void(0)">Home</a></li></ol>'))},loadItem:function(e){this.activeNode=e,e.hasClass("open-folder")&&(this.item.id=e.attr("id"),this.item.name=e.find(".folder-name").text(),this.item.node=e)},bind:function(e,t){var i;$(document).on("click",e,(i=this,function(e){return i.loadItem($(this)),i[t](e)}))}},dropzone:function(){return new Dropzone("#uploadzone",{url:ROOT+"/cpanel/upload/chunk",autoProcessQueue:!1,uploadMultiple:!1,parallelUploads:1,maxFilesize:3e3,chunking:!0,forceChunking:!0,parallelChunkUploads:!0,retryChunks:!0,retryChunksLimit:3,maxFiles:1,Upload:1,addedfile:function(e){let t=this.parent;cleanAlerts(this.parent.alertWrap),this.parent.setFileInfo(e),t.isReUpload?t.button.disable(!1):t.setBucketName()},chunksUploaded:function(e,t){let i=App.services.upload;i.waitForServerResponse(),$.ajax({url:ROOT+"/cpanel/upload/concat",type:"POST",data:{dzuuid:e.upload.uuid,dztotalchunkcount:e.upload.totalChunkCount},success:function(e){e.success?i.isReUpload?i.updateBucket():i.createBucket():(displayAlerts(e.alerts,i.alertWrap),i.canceled()),t()},error:function(t){e.accepted=!1}})},processing:function(e){let t=this.parent;t.loadModal("upload-progress-modal"),t.isReUpload&&t.node.modal("hide"),this.progress.timeStarted=new Date,t.isProcessing=!0,t.activeModal.find(".nb-file-size").text(formatBytes(e.size)),t.activeModal.find(".close").remove(),t.modal("show")},uploadprogress:function(e,t,i){isNaN(i)&&(i=Math.round(e.size*Math.round(t)/100));let a=i/((new Date-this.progress.timeStarted)/1e3),n=(e.size-i)/a;this.progress.progress=t,this.progress.bytesSent=i,this.progress.timeRemaining=n,this.progress.uploadSpeed=a,this.parent.updateProgress()},error:function(e,t){let i=this;this.parent.isProcessing?($.ajax({url:ROOT+"/cpanel/upload/del?dzuuid="+e.upload.uuid,type:"DELETE",success:function(e){}}),i.parent.canceled(),i.parent.error(t)):this.parent.error(t)},complete:function(){this.parent.isProcessing=!1}})},upload:{node:null,isReUpload:!1,reUpload:{status:!1,type:"auto",dest:"new-drive",toNewDrive:function(){this.dest="new-drive"},toExistFile:function(){this.dest="exist-file"},isAuto:function(){return"auto"===this.type}},isProcessing:!1,bucket:{id:0,name:""},folder:{id:0},file:null,driveIds:[0],dropzone:null,alertWrap:"",button:null,activeNode:null,activeModal:null,isRemoteUpload:!1,remoteUpload:{file:"",isValid:!1,checkFile:function(){let e=!1;return $.ajax({url:ROOT+"/cpanel/upload/check-file",type:"GET",data:{link:this.file},async:!1,success:function(t){t.success&&(e=!0)}}),e},run:function(e){e.node.modal("hide"),e.loadModal("upload-progress-modal"),e.waitForServerResponse(),e.modal("show"),this.checkFile()?e.createBucket():console.log("invalid file url")},hasInit:function(){return this.file=$("#remote-link").val(),this.isValid=!!isValidURL(this.file),!isEmpty(this.file)}},init:function(e){let t=this,i=$("#bucket");return t.dropzone=App.services.dropzone(),t.dropzone.parent=t,t.dropzone.progress={timeStarted:0,progress:0,bytesSent:0,timeRemaining:0,uploadSpeed:0},t.isReUpload&&(t.alertWrap="re-upload-alert-wrap"),t.node=t.isReUpload?$("#re-upload-modal"):$("#main-upload-wrap"),t.bind("#upload","upload"),t.bind(".drive-select","driveSelected","change"),t.bind(".select-re-upload-type","reUploadTypeSelected","change"),t.bind(".select-re-upload-dest-type","reUploadDestTypeSelected","change"),t.bind(".select-all-drives","drivesSelected"),t.bind(".cancel-upload","cancelUpload"),t.isReUpload&&(t.bucket.id=i.attr("data-id")),t.button=new Button($("#upload")),t.reUpload.status=t.isReUpload,$(window).bind("beforeunload",function(){if(t.isProcessing)return"Are you sure you want to leave?"}),t.loadActiveFolder(),t},cancelUpload:function(){this.dropzone.removeAllFiles(!0)},drivesSelected:function(){"select-all"===this.activeNode.attr("data-action")?$(".c-drive-select").prop("checked",!0):$(".c-drive-select").prop("checked",!1)},loadActiveFolder:function(){this.isReUpload||(this.folder.id=this.node.attr("data-tmp-folder"))},upload:function(){let e=this,t=!1,i=e.dropzone.getQueuedFiles();e.button.node.hasAttr("data-action")&&(e.remoteUpload.hasInit()&&(e.isRemoteUpload=!0),"next"!==e.button.node.attr("data-action")&&(e.setDriveIds(),e.setBucketName()),e.isReUpload&&"next"===e.button.node.attr("data-action")?($(".file-info-wrap").hide(),$(".drive-list-wrap").show(),e.button.node.text("Upload"),e.button.node.attr("data-action","upload"),e.button.disable()):t=!0,t&&e.validate()&&(e.alertWrap="progress-alert-wrap",this.isReUpload&&this.reUpload.isAuto()?this.updateBucket():e.isRemoteUpload?e.remoteUpload.run(e):e.dropzone.processFile(i[0])))},updateBucket:function(){let e=this,t={bucketId:e.bucket.id,drives:JSON.stringify(e.getDriveIds()),type:e.reUpload.type,dest:e.reUpload.dest};this.reUpload.isAuto()?(e.node.modal("hide"),e.loadModal("upload-progress-modal"),e.waitForServerResponse(),e.modal("show")):t.dzuuid=e.file.upload.uuid,$.ajax({url:ROOT+"/cpanel/buckets/update",type:"POST",data:t,success:function(t){t.success?e.success():e.canceled(),displayAlerts(t.alerts,e.alertWrap)},error:function(e){}})},createBucket:function(){let e=this,t={drives:JSON.stringify(e.getDriveIds()),bucketName:e.bucket.name,folder:e.folder.id};e.isRemoteUpload?t.link=e.remoteUpload.file:t.dzuuid=e.file.upload.uuid,(e.isRemoteUpload||null!==e.file)&&$.ajax({url:ROOT+"/cpanel/buckets/new",type:"POST",data:t,success:function(t){t.success?(e.bucket.id=t.data.id,e.success()):e.canceled(),displayAlerts(t.alerts,e.alertWrap)},error:function(t){e.file.accepted=!1}})},validate:function(){let e=this,t=e.dropzone.getQueuedFiles(),i="";return 0===e.driveIds.length&&(i="You must select least 1 cloud drive"),e.isReUpload?isEmpty(e.bucket.id)&&(i="Bucket ID not found"):isEmpty(e.bucket.name)&&(i="Bucket name is required"),e.isRemoteUpload?e.remoteUpload.isValid||(i="Remote upload url is Invalid"):e.reUpload.isAuto()||0!==t.length||(i="File is required"),!!isEmpty(i)||(e.error(i),!1)},driveSelected:function(){this.activeNode.prop("checked")?this.button.disable(!1):this.button.disable()},reUploadTypeSelected:function(){let e=this.activeNode,t=$(".re-upload-auto"),i=$(".re-upload-manually");"auto"===e.val()?(t.show(),i.hide(),this.reUpload.type="auto",this.button.disable(!1)):(i.show(),t.hide(),this.reUpload.type="manually",this.button.disable())},reUploadDestTypeSelected:function(){let e=this.activeNode,t=$(".to-new-drive"),i=$(".to-exit-file");$("input:checkbox[name=drives]").prop("checked",!1),this.button.disable(),"new-drive"===e.val()?(t.show(),i.hide(),this.reUpload.toNewDrive()):(i.show(),t.hide(),this.reUpload.toExistFile())},updateProgress:function(){let e=this.activeModal,t=this.dropzone.progress;t.timeRemaining<0&&(t.timeRemaining=0),t.progress=Math.round(t.progress),e.find(".nb-progress").text(t.progress),e.find(".nb-time-remaining").text(timeFormat(t.timeRemaining)),e.find(".nb-upload-speed").text(formatBytes(t.uploadSpeed,0)+"/s"),e.find(".nb-uploaded").text(formatBytes(t.bytesSent));let i=e.find(".progress-bar");i.css("width",t.progress+"%"),i.attr("aria-valuenow",t.progress)},setFileInfo:function(e){let t=this.node.find(".file-info");this.file=e,t.length>0&&(t.find(".fname").text(e.name),t.find(".fsize").text(formatBytes(e.size)),t.find(".ftype").text(e.type),t.show())},setBucketName:function(){let e=this.file,t=$(".bucket-name");0===this.bucket.name.length&&null!==e&&(this.bucket.name=e.name,t.val(e.name)),isEmpty(this.bucket.name)&&(isEmpty(t.val())?this.bucket.name="":this.bucket.name=t.val())},setDriveIds:function(){let e=this,t=[],i="";i=e.isReUpload?"input:checkbox[name=drives][data-type="+e.reUpload.dest+"]:checked":"input:checkbox[name=drives]:checked",$(i).each(function(){t.push($(this).val())}),e.driveIds=t},setFolderId:function(e){this.folder.id=e},getDriveIds:function(){return this.driveIds},error:function(e){addAlert(e,"danger",this.alertWrap)},canceled:function(){let e=this.activeModal;e.find(".modal-title").text("Error Occurred."),e.find(".progress-wrap, .modal-footer, .waiting-resp-msg").remove(),setTimeout(function(){window.location.reload()},5e3)},success:function(){let e=this,t=this.activeModal;t.find(".modal-title").text("Success !"),t.find(".waiting-resp-msg").remove(),setTimeout(function(){e.isReUpload?window.location.reload():window.location.href=ROOT+"/cpanel/buckets/view/"+e.bucket.id},2e3)},waitForServerResponse:function(){let e=this.activeModal;e.find(".modal-title").text("Please wait..."),e.find(".progress-wrap, .modal-footer").remove(),e.find(".waiting-resp-msg").css("display","flex")},setSelectedFolder:function(e,t,i){$(".upload-path").val(i),this.setFolderId(e)},loadModal:function(e){let t="#"+e;this.activeModal=$(t)},modal:function(e){this.activeModal.modal(e)},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t](e)}))}},tracker:{node:null,bucketId:0,lastId:0,activeIds:[],isDone:!1,init:function(){return this.node=$("#tracker"),this.bucketId=$("#bucket").attr("data-id"),this},run:function(){let e=this;e.loadActiveIds(),e.loadLastId(),$.ajax({url:ROOT+"/cpanel/tracker/data",data:{bucket:e.bucketId,last:e.lastId,active:JSON.stringify(e.activeIds)},type:"get",success:function(t){if(t.success){let i=t.data;if("data"in i){let t=i.data;void 0!==t.length&&t.length>0&&e.update(t)}e.isUploadProcessCompleted()||setTimeout(function(){e.run()},1e3)}},complete:function(){}})},loadLastId:function(){let e=this.node.find('tr[data-status="waiting"]'),t=e.prev(),i=e.first(),a=this.node.find("tbody tr").last();this.lastId=0,t.length>0?(this.lastId=t.attr("id"),i.length>0&&i.attr("id")===e.attr("id")&&(this.lastId=parseInt(i.attr("id"))-1)):"waiting"===e.attr("data-status")?this.lastId=parseInt(e.attr("id"))-1:this.lastId=parseInt(a.attr("id"))-1},loadActiveIds:function(){let e=[];this.node.find('tr[data-status="process"]').each(function(){e.push($(this).attr("id"))}),this.activeIds=e},isUploadProcessCompleted:function(){let e=this.node.find('tr[data-status="waiting"]'),t=this.node.find('tr[data-status="process"]');return 0===e.length&&0===t.length},update:function(e){let t=this;e.forEach(function(e,i){let a=t.node.find('tr[id="'+e.fileId+'"]'),n=a.find(".progress-wrap");if(n.find(".currentSpeed").text(e.currentSpeed),n.find(".progress-bar-text").text(e.progress+" %"),n.find(".progress-bar").attr("aria-valuenow",e.progress),n.find(".progress-bar").css("width",e.progress+"%"),n.find(".remainingTime").text(e.remainingTime),a.find(".status-text").text(e.pstatus),a.find(".status").addClass(e.pstatus),a.attr("data-status",e.pstatus),1!==e.isTracking&&"process"!==e.pstatus){let t="";n.remove(),t="active"===e.pstatus?'<span class="text-primary font-weight-bold"> '+e.code+" </span>":'<span class="text-danger"> '+e.msg+" </span>",a.find(".message").html(t)}})}},bucketList:{node:null,folderId:0,activeModal:null,activeNode:null,activeDrive:0,item:{id:0,type:"",isFile:"",parent:null},init:function(){this.node=$(".bucket-list-wrap"),this.currentFolderId=parseInt(this.node.attr("data-active-folder"));this.bind(".rename-bucket","rename"),this.bind(".delete-bucket","delete"),this.bind(".move-bucket","move"),this.bind("#create-folder","createFolder"),this.bind("#select-drives-list","driveSelected","change");let e=$("#bucket-list-tbl");if(e.length>0){e.DataTable({order:[]});let t=$("#buckets-breadcrumb").clone();t.show(),$("#bucket-list-tbl").before(t)}else $("#buckets-breadcrumb").show();return this.activeDrive=$("#select-drives-list").val(),this},driveSelected:function(){let e=this.activeNode.val();redirect("/buckets/list?drive="+e)},move:function(e,t,i,a){let n=this;if(void 0!==t){0===e&&(e=1);let t=new Button(a.activeNode);$.ajax({url:ROOT+"/cpanel/folders/move",type:"POST",data:{from:n.item.id,to:e,type:n.item.type},beforeSend:function(){t.loading()},success:function(e){e.success&&(n.item.parent.remove(),setTimeout(function(){a.close()},1500)),displayAlerts(e.alerts,a.alertWrap)},error:function(e,t){},complete:function(){t.loaded()}})}},createFolder:function(){let e=this,t=$("#new-folder-name").val(),i=new Button(this.activeNode);t.length>0?$.ajax({url:ROOT+"/cpanel/folders/new",type:"POST",data:{name:t,parent:e.currentFolderId},beforeSend:function(){i.loading()},success:function(t){if(t.success){let i=t.data.folderId;setTimeout(function(){redirect("/buckets/list/"+i+"?drive="+e.activeDrive)},1e3)}displayAlerts(t.alerts,"new-folder-alert-wrap")},error:function(e,t){},complete:function(){i.loaded()}}):addAlert("Folder name is required","danger","new-folder-alert-wrap")},delete:function(){this.loadModal("del-bucket-modal");let e=this.item,t=this,i=new Button(this.activeNode);this.activeNode.hasAttr("data-confirm")?(t.activeModal.find(".msg").show(),cleanAlerts("folder-del-alert-wrap"),t.modal("show")):e.id.length>0?$.ajax({url:ROOT+"/cpanel/folders/delete",type:"POST",data:{id:e.id,type:e.type},beforeSend:function(){i.loading()},success:function(i){i.success&&(e.parent.remove(),setTimeout(function(){t.modal("hide")},2e3)),t.activeModal.find(".msg").hide(),displayAlerts(i.alerts,"folder-del-alert-wrap")},error:function(e,t){},complete:function(){i.loaded()}}):addAlert("something went wrong","danger")},rename:function(){this.loadModal("rename-bucket-modal");let e=this.activeNode,t=this.item,i=t.parent.find(".name-txt"),a=i.text(),n=$("#new-bucket-name"),s=$("#file-ext");if("get-data"===e.attr("data-rename"))n.val(a),s.text(t.parent.find(".file-ext").text()),this.item.isFile?s.show():s.hide(),cleanAlerts("rename-bucket-alert-wrap"),this.modal("show");else if(t.id.length>0){let e=this,s=n.val(),o=new Button(this.activeNode);s.length>0?a!==s?$.ajax({url:ROOT+"/cpanel/folders/rename",type:"POST",data:{folder:t.id,name:s,type:t.type},beforeSend:function(){o.loading()},success:function(t){t.success&&(i.text(s),setTimeout(function(){e.modal("hide")},2e3)),e.activeModal.find(".msg").hide(),displayAlerts(t.alerts,"rename-bucket-alert-wrap")},error:function(e,t){},complete:function(){o.loaded()}}):this.modal("hide"):addAlert("bucket name is required","danger")}else addAlert("something went wrong","danger")},loadItem:function(e){this.activeNode=e;let t=e.closest("tr");t.length>0&&(this.item.id=t.attr("id"),this.item.type=t.attr("data-type"),this.item.isFile="bucket"===this.item.type,this.item.parent=t)},loadModal:function(e){let t="#"+e;this.activeModal=$(t)},modal:function(e){this.activeModal.modal(e)},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.loadItem($(this)),a[t](e)}))}},bucketView:{node:null,bucket:{id:0,name:"",link:"",ext:"",drives:[],shared:!1,node:""},files:{node:null,bucketId:0,activeModal:null,activeNode:null,item:{id:0,status:"",node:null},init:function(){this.bind(".delete-file","delete"),this.bucketId=$("#bucket").attr("data-id")},delete:function(){let e=this;this.loadModal("del-file-modal");let t="file-del-alert-wrap",i=new Button(e.activeNode);e.activeNode.hasAttr("data-confirm")?(e.activeModal.find(".msg").show(),cleanAlerts(t),e.modal("show")):e.item.id.length>0?$.ajax({url:ROOT+"/cpanel/files/delete",type:"POST",data:{fileId:e.item.id,bucketId:e.bucketId},beforeSend:function(){i.loading()},success:function(i){i.success&&(e.item.node.remove(),setTimeout(function(){e.modal("hide")},1200)),e.activeModal.find(".msg").hide(),displayAlerts(i.alerts,t)},error:function(e,t){},complete:function(){i.loaded()}}):addAlert("something went wrong","danger",t)},loadItem:function(e){this.activeNode=e;let t=e.closest("tr");t.length>0&&(this.item.id=t.attr("id"),this.item.status=t.attr("data-status"),this.item.node=t)},loadModal:function(e){let t="#"+e;this.activeModal=$(t)},modal:function(e){this.activeModal.modal(e)},bind:function(e,t){var i;$(e).on("click",(i=this,function(e){return i.loadItem($(this)),i[t](e)}))}},share:{node:null,parent:null,linkNode:null,alertWrap:"share-bucket-alert-wrap",init:function(e){this.parent=e,this.loadModal("share-bucket-modal"),this.bind(".share-bucket","display"),this.bind(".copy-bucket-shared-link","copyLink"),this.bind(".active-cloud-drive-list","driveSelected","change"),this.node=this.activeModal,this.linkNode=this.node.find("input.bucket-link")},driveSelected:function(){let e=this.activeNode.val(),t=this.parent.bucket.link+"/"+e;this.linkNode.val(t)},copyLink:function(){let e=this.activeNode;e.text("Copied"),copyToClipboard(this.linkNode.val()),setTimeout(function(){e.text("Copy")},1500)},display:function(){let e=this,t=e.node,i=t.find(".active-cloud-drive-list"),a=t.find(".bucket-shared-info"),n=e.parent.bucket.shared?"shared":"unshared",s=t.find(".share-bucket");e.activeNode.hasAttr("data-share-status")?e.toggleShared():("0"===t.attr("data-loaded")&&(e.linkNode.val(e.parent.bucket.link),e.parent.bucket.drives.forEach(function(e,t){i.append('<option value="'+e+'">'+e+"</option>")}),s.attr("data-share-status",n),t.attr("data-loaded",1)),e.modal("show")),e.parent.bucket.shared?(a.show(),s.text("Unshare"),addAlert("Anyone with this link can visit into files in bucket","info",e.alertWrap)):(a.hide(),s.text("Share"),addAlert("Bucket not shared. Only you have access","warning",e.alertWrap))},toggleShared:function(){let e=this,t=new Button(e.activeNode);$.ajax({url:ROOT+"/cpanel/buckets/shared",type:"POST",data:{bucketId:e.parent.bucket.id,st:Number(e.parent.bucket.shared)},async:!1,beforeSend:function(){t.loading()},success:function(t){t.success?e.parent.bucket.shared=!e.parent.bucket.shared:addAlert("Something went wrong","danger",e.alertWrap)},error:function(e,t){},complete:function(){t.loaded()}})},loadModal:function(e){let t="#"+e;this.activeModal=$(t)},modal:function(e){this.activeModal.modal(e)},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t](e)}))}},downloadProgress:!1,init:function(){this.files.init(),this.share.init(this),this.bind(".rename-bucket","rename"),this.bind(".delete-bucket","delete"),this.node=$("#bucket"),this.loadBucketInfo(),this.checkDownloadProcess()},loadBucketInfo:function(){let e=$(".bucket-name"),t=[],i="1"===this.node.attr("data-shared");$(".drive-files tbody tr").each(function(){let e=$(this).attr("data-type");t.includes(e)||t.push(e)}),t.sort(),this.bucket.name=e.find(".name-txt").text(),this.bucket.ext=e.find(".file-ext").text(),this.bucket.id=this.files.bucketId,this.bucket.link=$("#bucket-link").attr("href"),this.bucket.drives=t,this.bucket.node=e,this.bucket.shared=i},checkDownloadProcess:function(){let e=this;$.ajax({url:ROOT+"/cpanel/download/get-progress",data:{bucket_id:e.bucket.id},type:"get",success:function(t){if(t.success){let i=t.data;$.isEmptyObject(i)||(i.isDone?(e.downloadProgress=!1,e.updateDownloadProgress("",!0)):(e.downloadProgress=!0,e.updateDownloadProgress(i))),e.downloadProgress&&setTimeout(function(){e.checkDownloadProcess()},1e3)}else e.updateDownloadProgress("",!0)},complete:function(){}})},updateDownloadProgress:function(e,t=!1){let i=$(".rm-progress-wrap"),a=$("#rm-file-download-progress");t?a.remove():(a.show(),i.find(".currentSpeed").text(e.currentSpeed),i.find(".progress-bar-text").text(e.progress+" %"),i.find(".progress-bar").attr("aria-valuenow",e.progress),i.find(".progress-bar").css("width",e.progress+"%"),i.find(".remainingTime").text(e.remainingTime))},rename:function(){this.loadModal("rename-bucket-modal");let e=this,t=this.activeNode,i=$("#new-bucket-name"),a=$("#file-ext");if("get-data"===t.attr("data-rename"))i.val(e.bucket.name),a.text(e.bucket.ext),cleanAlerts("rename-bucket-alert-wrap"),this.modal("show");else if(e.bucket.id.length>0){let t=i.val(),a=new Button(this.activeNode);t.length>0?e.bucket.name!==t?$.ajax({url:ROOT+"/cpanel/folders/rename",type:"POST",data:{folder:e.bucket.id,name:t,type:"bucket"},beforeSend:function(){a.loading()},success:function(i){i.success&&(e.bucket.node.find(".name-txt").text(t),e.bucket.name=t,setTimeout(function(){e.modal("hide")},1200)),displayAlerts(i.alerts,"rename-bucket-alert-wrap")},error:function(e,t){},complete:function(){a.loaded()}}):this.modal("hide"):addAlert("bucket name is required","danger")}else addAlert("something went wrong","danger")},delete:function(){this.loadModal("del-bucket-modal");let e=this,t=new Button(this.activeNode);e.activeNode.hasAttr("data-confirm")?(e.activeModal.find(".msg").show(),cleanAlerts("folder-del-alert-wrap"),e.modal("show")):e.bucket.id.length>0?$.ajax({url:ROOT+"/cpanel/folders/delete",type:"POST",data:{id:e.bucket.id,type:"bucket"},beforeSend:function(){t.loading()},success:function(t){t.success&&setTimeout(function(){window.location.href=ROOT+"/cpanel/buckets/list"},2e3),e.activeModal.find(".msg").hide(),displayAlerts(t.alerts,"folder-del-alert-wrap")},error:function(e,t){},complete:function(){t.loaded()}}):addAlert("something went wrong","danger")},loadModal:function(e){let t="#"+e;this.activeModal=$(t)},modal:function(e){this.activeModal.modal(e)},bind:function(e,t){var i;$(e).on("click",(i=this,function(e){return i.activeNode=$(this),i[t](e)}))}},search:{activeNode:null,inputNode:null,resultsListNode:null,searchNode:null,init:function(){let e=this;e.bind("#main-search-input","loadResults","keyup"),e.inputNode=$("#main-search-input"),e.resultsListNode=$(".search-results-wrap .list-group"),e.searchNode=$(".search-results-wrap"),$(document).mouseup(function(t){e.searchNode.is(t.target)||0!==e.searchNode.has(t.target).length||e.inputNode.is(t.target)||0!==e.inputNode.has(t.target).length||e.reset()})},loadResults:function(){let e=this,t=e.inputNode.val();t.length>=3?$.ajax({url:ROOT+"/cpanel/search/",type:"GET",contentType:"application/json",dataType:"json",data:{term:t},async:!1,beforeSend:function(){e.reset()},success:function(t){t.success&&($.isEmptyObject(t.data)?e.noResults():(e.appendData(t.data),e.showResults()))},error:function(e,t){alert("error occurred")},complete:function(){}}):e.reset()},appendData:function(e){let t=this;Object.keys(e).forEach(function(i){let a=e[i],n=$('<li class="list-group-item "><a href="#" class="d-flex align-items-center text-white "><span class="cut-text sname"></span><span class="badge  ml-auto ftype"></span></a></li>'),s=ROOT+"/cpanel/";"bucket"===a.ftype?(s+="buckets/view/"+a.id,n.find(".ftype").addClass("bg-primary")):(s+="buckets/view?file="+a.id,n.find(".ftype").addClass("bg-warning")),n.find("a").attr("href",s),n.find(".sname").text(a.name),n.find(".ftype").text(a.ftype),t.resultsListNode.append(n)})},showResults:function(){this.searchNode.removeClass("no-results"),this.searchNode.show()},noResults:function(){this.searchNode.hasClass("no-results")||this.searchNode.addClass("no-results"),this.searchNode.show()},reset:function(){this.resultsListNode.html(""),this.searchNode.hide()},bind:function(e,t,i="click"){var a;$(document).on(i,e,(a=this,function(e){return a.activeNode=$(this),a[t](e)}))}}},sayHello:function(){console.log("%c!"+this.name,"color:#1b59a3;font-family:system-ui;font-size:4rem;-webkit-text-stroke: 1px black;font-weight:bold")}};App.init();